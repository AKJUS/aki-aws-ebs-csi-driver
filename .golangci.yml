# Copyright 2024 The Kubernetes Authors.
#
# Licensed under the Apache License, Version 2.0 (the 'License');
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an 'AS IS' BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

run:
  modules-download-mode: readonly
issues:
  exclude-rules:
    # gosec recommends ignoring test files
    - path: (.+)_test.go
      linters:
        - gosec
    - path: tests/e2e
      linters:
        - gosec
linters-settings:
  revive:
    rules:
      # Using += 1 instead of ++ is fine
      - name: increment-decrement
        disabled: true
  stylecheck:
    # Dot importing ginkgo and gomega is standard practice
    dot-import-whitelist:
      - "github.com/onsi/gomega"
      - "github.com/onsi/ginkgo/v2"
linters:
  enable:
    - asasalint
    - asciicheck
    - bidichk
    - bodyclose
    - canonicalheader
    - containedctx
    - contextcheck
    - copyloopvar
    - decorder
    - dogsled
    - dupword
    - durationcheck
    - errcheck
    - errchkjson
    - errname
    - errorlint
    - exhaustive
    - fatcontext
    - forbidigo
    - forcetypeassert
    - gci
    - ginkgolinter
    - gocheckcompilerdirectives
    - gochecksumtype
    - gocritic
    - gofmt
    - goheader
    - goimports
    - gomodguard
    - goprintffuncname
    - gosimple
    - gosmopolitan
    - grouper
    - importas
    - inamedparam
    - ineffassign
    - intrange
    - loggercheck
    - makezero
    - mirror
    - misspell
    - musttag
    - nakedret
    - nilerr
    - nilnil
    - noctx
    - nolintlint
    - nosprintfhostport
    - prealloc
    - predeclared
    - promlinter
    - protogetter
    - reassign
    - rowserrcheck
    - sloglint
    - spancheck
    - sqlclosecheck
    - staticcheck
    - stylecheck
    - tagalign
    - tagliatelle
    - tenv
    - testableexamples
    - testifylint
    - thelper
    - tparallel
    - unconvert
    - unparam
    - unused
    - usestdlibvars
    - wastedassign
    - whitespace
    - zerologlint
    - goconst
    - gochecknoinits
    - perfsprint
    - revive
    - gosec
    - gochecknoglobals  # TODO FIXME
  disable:
    - govet # We already run with `make verify/govet`
    # We do not use
    - gomoddirectives # We need `replace` in `go.mod`
    - depguard # We don't guard against dependencies
    - testpackage # Requires separate test package
    - funlen # Long names happen
    - maintidx # Maintainability Index
    - cyclop # Cyclomatic complexity
    - wsl # Too strict of a whitespace linter
    # TODO Investigate FIXME
    - dupl # TODO FIXME (tests + non-tests)
    - err113 # TODO FIXME
    - wrapcheck # Many false positives
    - varnamelen # Many false positives
    - mnd # Many false positives
    - gomnd # Many false positives
    - paralleltest # TODO FIXME (Too many tests that aren't parallelized right now)
    - nestif # Many false positives
    - gocognit # Many false positives
    - godox # TODO FIXME
    # Ask team
    - lll # Limit line length
    - godot # TODO Ask team if we want to end all godoc comments with period
    - gofumpt # TODO Ask team if we want to rely on gofumpt
    - ireturn # ask team if we want to accept interfaces return concrete types
    - nlreturn # Meh, ask team newline return
    - nonamedreturns # Ask team, maybe nolint a few of the places it actually leads to cleaner code
    - exhaustruct # Seems REALLY painful for kubernetes structs...
    - interfacebloat # Cloud and Mounter have 15 instead of 10... Smell or necessary? We can nolint
